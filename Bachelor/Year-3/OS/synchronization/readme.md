# Задачи на синхронизацию

## Блок задач на «удовлетворительно»

1. [Проблема конкурентного доступа к разделяемому ресурсу](3/queue_destroy)
	1. В каталоге `sync` репозитория `git@github.com:mrutman/os.git` вы найдете простую реализацию очереди на списке. Изучите код, соберите и запустите программу `queue-example.c`. Посмотрите вывод программы и убедитесь что он соответствует вашему пониманию работы данной реализации очереди. Добавьте реализацию функции `queue_destroy()`.
	2. Изучите код программы `queue-threads.c` и разберитесь что она делает. Соберите программу.
		1. Запустите программу несколько раз. Если появляются ошибки выполнения, попытайтесь их объяснить и определить что именно вызывает ошибку. Какие именно ошибки вы наблюдали?
		2. Поиграйте следующими параметрами:
			1. размером очереди (задается в `queue_init()`). Запустите программу с размером очереди от 1000 до 1000000.
			2. привязкой к процессору (задается функцией `set_cpu()`). Привяжите потоки к одному процессору (ядру) и к разным.
			3. планированием потоков (функция `sched_yield()`). Попробуйте убрать эту функцию перед созданием второго потока.
		3. Объясните наблюдаемые результаты.
2. [Синхронизация доступа к разделяемому ресурсу](3/spinlock)
	1. (*a*) Измените реализацию очереди, добавив спинлок для синхронизации доступа к разделяемым данным.
	2. (*b*) Убедитесь, что не возникает ошибок передачи данных через очередь.
	3. (*c*) Поиграйте параметрами из пункта 2.1:
		1. Оцените загрузку процессора.
		2. Оцените время проведенное в пользовательском режиме и в режиме ядра.
		3. Оцените текущую заполненность очереди, количество попыток чтения-записи и количество прочитанных-записанных данных.
		4. Объясните наблюдаемые результаты.
	4. (*d*) Часто бывает, что поток пишущий данные в очередь вынужден ожидать их (например, из сети на `select()`/`poll()`). Проэмулируйте эту ситуацию, добавив в поточную функцию писателя периодический вызов `usleep(1)`. Выполните задания из пункта *с*.
	5. [Измените реализацию очереди, заменив спинлок на мутекс](3/mutex). Проделайте задания из пунктов *b*, *c* и *d*. Сравните со спинлоком.
	6. [Измените реализацию очереди, добавив условную переменную](3/cond). Проделайте задания из пунктов *b*, *c* и *d*. Сравните со спинлоком и мутексом.
	7. [Используйте для синхронизации доступа к очереди семафоры](3/sem). Проделайте задания из пунктов *b*, *c* и *d*. Сравните со спинлоком, мутексом и условной переменной.

## Блок задач на «хорошо»

## Блок задач на «отлично»
